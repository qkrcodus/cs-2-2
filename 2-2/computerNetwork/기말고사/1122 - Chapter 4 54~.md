내 고유 IP 가 있어야 통신을 시작한다.

내 집에서 사설 IP가 사용됨.
![[Pasted image 20241122121007.png]]
그렇다면? 나의 라우터에서 밖으로 나가는 라인은 고유 IP를 갖고 있어야 한다. 138.76.29.7
![[Pasted image 20241122121016.png]]
네트워크에서 138.76.29.7 IP 1개만을 사용한다.

모든 데이터그램은  공인 IP 138.76.29.7 가지고 네트워크로 나간다.

datagram은 router의 income으로 도착한다. 138.76.29.7

source # 가 다르면 어떻게 처리할까??? =>NAT

- ISP (sk,kt,lg) 를 바꿀 수 있다. ( 공인 IP 138.76.29.7 같은 애들) 내 디바이스의 로컬 네트워크의 주소를 변경하지 않고도
- 디바이스들이 밖에선 식별되면 안된다. 외부에선 라우터의 IP 1개만 볼 수 있다. 


#### NAT router는?
내꺼 10.0.0.1 포트번호 300 는 외부랑 통신할 때 138.76.29.7 과 포트번호로 바뀌여서 나간다.
안 => 밖 밖=>안 바뀌는걸 NAT translation table 보고 안다.
들어오는거 처리

host A  10.0.0.1 300
router
138.76.29.7 3001
server
138.76.29.7 3001도착

server
138.76.29.7 3001
router
<routing table 에서 3001->300  138.76.29.7->10.0.0.1> 확인하고
host A로 값을 준다. 


##### 예시 
프로세스 통신에서 소켓을 열어서 시작된다.
내 포트번호는 3345
서비스의 포트번호는 80
![[Pasted image 20241122122923.png]]

고민이 있다. !
내가 보내면서 내 포트 3345를 열고 80포트랑 연결해서 시작되었지만,

왼->오 로 요청보낸다면??? 1. NAT traveler 프로토콜로 확인 2. wellknown port 사용하는 애들은 이미 정의되있는 표 보고 확인

##### NAT 논란
- 라우터는 3계층까지만 처리해야 한다. (IP) 
4계층의 프로토콜 tcp udp 소켓의 포트번호인데 어떻게 라우터가 4계층 패킷의 포트번호를 아냐???
- 한정된  ip 는 IPv6으로?? 이 방법은 불가
- 종단간 원칙을 위반 => 네트워크 경로상에서 이러한 정보가 변경
- NAT traversal

##### IPv4 -> IPv6 뭐가 추가되고 바뀌고 정도까지만
32bit address 사용 IP 개수가 부족해지는 문제를 해결하기 위해
텍스트 -> 영상 으로 바뀌는 데이터의 처리 (MTU: 한번에 보낼 수 있는 패킷 크기 1500 byte)
QoS (service quality) 향상 단, best effort 전제

40 byte header 고정 왜? IPv4 에선 헤더 유동적이였는데
따라서 옵션부 처리해주는 부분이 필요해졌다
간편화 X  MTU X

- 많은 양을 flow로 보내자. 단, 우선순위는 있다.
- 옵션 사용 안해서 next header에 
- 4계층 checksum 은 router에서 까보지 않음 3계층 checksum은 라우터마다 까보고 오류체크할거다. 이건 과거 IPv4방식 시간 오래 걸린다. 대량의 데이터를 보내기로 한 IPv6에선 라우터마다 오류 확인하면 시간 오래걸린다. 
  어차피 문제 있으면 4계층 즉, end to end에서 해결해줄거야 그냥 빨리 데이터 보내자
- ICMP 
![[Pasted image 20241122125456.png]]
##### IPv4 -> IPv6 
- 한번에 router 업그레이드 못해
- 섞인다면?
 IPv6(교수님) 는 IPv4(교수님 동생) 베이스. IPv4 IPv6를 몰라. 쓸 수 있게 해주는 애가 tunneling
##### tunneling
IPv6는 IPv4 없는 것처럼 생각. 
![[Pasted image 20241122130358.png]]
 IPv6 IPv4  IPv4  IPv4  IPv4 IPv6 

![[Pasted image 20241122130538.png]]
써야하는 데이터

![[Pasted image 20241122130616.png]]
src B dest E , IPv6 패킷은 IPv4 패킷 내에 캡슐화되어, IPv4 인프라를 통해 전송


4장 마무리!!!! 다음부터 controlplane( routing  어떻게 ??


IPV6 (폰) IPV4(컴퓨터)
IPV6이 나오게 된 배경은, 사용가능한 ip 수가 적어지자 
주소를 -bit
ipv4는 ipv6 모른다. 나중에 나온 애니까. ipv4가 ipv6을 사용가능하게 해준게 tunneling
ipv6은 ipv4가 없다고 생각한다. 
